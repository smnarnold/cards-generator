resources:
- repo: self
queue:
  name: Hosted VS2017
  demands: 
  - npm
  - node.js
  - azureps

steps:
- task: Npm@1
  displayName: 'npm install'
  inputs:
    workingDir: '_frontend'

    verbose: false


- task: Gulp@0
  displayName: 'gulp production'
  inputs:
    gulpFile: '_frontend/gulpfile.js'

    targets: production


- task: AzureFileCopy@1
  displayName: 'AzureBlob File Copy'
  inputs:
    SourcePath: assets

    azureSubscription: 'Boomerang 2018 - PROD (1e78d963-f6b2-486e-9d0c-89d03c28381a)'

    Destination: AzureBlob

    storage: boomerang2018assets

    ContainerName: assets


- task: DeleteFiles@1
  displayName: 'Delete unnecessary files'
  inputs:
    SourceFolder: .

    Contents: |
     .git/**
     _frontend/**
     assets/video/**
     .env


- task: ArchiveFiles@2
  displayName: 'Archive everything'
  inputs:
    rootFolderOrFile: '$(Build.SourcesDirectory)'

    includeRootFolder: false


- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: drop'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'


